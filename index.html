<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>시장 현황 요약</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Noto Sans KR", sans-serif;
  background: #ffffff;
}
.wrap {
  max-width: 900px;
  margin: 0 auto;
  padding: 16px;
}
h1 {
  font-size: 22px;
  margin-bottom: 6px;
}
.muted {
  font-size: 12px;
  color: #666;
  margin-bottom: 18px;
}
.box {
  border: 1px solid #e5e5e5;
  border-radius: 12px;
  padding: 14px;
  margin-bottom: 18px;
}
.k {
  font-size: 13px;
  color: #666;
  margin-bottom: 6px;
}
.v {
  font-size: 22px;
  font-weight: 700;
}
iframe {
  width: 100%;
  height: 320px;
  border: none;
}
canvas {
  width: 100% !important;
  height: 280px !important;
}
</style>
</head>

<body>
<div class="wrap">
  <h1>시장 현황 요약</h1>
  <div class="muted">
    환율·유가: 실시간 (TradingView) / 미국채 10Y: 30분 기준 (Yahoo Finance)
  </div>

  <!-- USD/KRW -->
  <div class="box">
    <div class="k">USD/KRW 환율 · REAL-TIME</div>
    <iframe
      src="https://s.tradingview.com/widgetembed/?symbol=FX_IDC:USDKRW&interval=5&hidesidetoolbar=1&symboledit=0&saveimage=0&toolbarbg=ffffff&studies=[]&theme=light&style=3&timezone=Asia/Seoul">
    </iframe>
  </div>

  <!-- WTI -->
  <div class="box">
    <div class="k">WTI 유가 · REAL-TIME</div>
    <iframe
      src="https://s.tradingview.com/widgetembed/?symbol=NYMEX:CL1!&interval=5&hidesidetoolbar=1&symboledit=0&saveimage=0&toolbarbg=ffffff&studies=[]&theme=light&style=3&timezone=Asia/Seoul">
    </iframe>
  </div>

  <!-- US 10Y -->
  <div class="box">
    <div class="k">미국채 10년물 수익률 (10Y)</div>
    <div class="v" id="v_10y">-</div>
    <canvas id="chart10y"></canvas>
  </div>
</div>

<script>
async function loadUS10Y() {
  const res = await fetch('./data/us10y.json?t=' + Date.now());
  const json = await res.json();

  const prices = json.chart.result[0].indicators.quote[0].close;
  const times = json.chart.result[0].timestamp.map(ts =>
    new Date(ts * 1000).toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' })
  );

  const last = prices[prices.length - 1];
  document.getElementById('v_10y').innerText = last.toFixed(2) + ' %';

  new Chart(document.getElementById('chart10y'), {
    type: 'line',
    data: {
      labels: times,
      datasets: [{
        data: prices,
        borderColor: '#333',
        borderWidth: 2,
        pointRadius: 0
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: {
        x: { display: false },
        y: { ticks: { callback: v => v.toFixed(2) } }
      }
    }
  });
}

loadUS10Y();
</script>

</body>
</html>
